(()=>{const n="#pvw-btn{position:fixed;right:18px;bottom:18px;z-index:99999;border:none;border-radius:999px;padding:14px 16px;font:600 14px/1.1 system-ui,Segoe UI,Arial;background:#10b981;color:#fff;box-shadow:0 8px 18px rgba(0,0,0,.2);cursor:pointer}#pvw-btn.pvw-on{background:#ef4444}";function e(t,o={},a=[]){const r=document.createElement(t);Object.entries(o).forEach(([c,d])=>c in r?r[c]=d:r.setAttribute(c,d));return a.forEach(c=>r.append(c)),r}async function s(){const t=await fetch("/agent.config.json",{cache:"no-store"});return t.json()}async function i(t,o){const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o})});const r=await a.json();if(!r.ok)throw new Error(r.error||"reply_failed");return r.text}async function l(t,o,a){const r=`${t}?mode=file&voice=${encodeURIComponent(o)}&text=${encodeURIComponent(a)}`,c=new Audio(r);return c.play().catch(()=>{}),c}async function p(){const t=await s(),o=e("style",{textContent:n}),a=e("button",{id:"pvw-btn",textContent:" Talk"});document.head.append(o),document.body.append(a);let r,c=!1;a.onclick=async()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return a.textContent="speaking demo",a.disabled=!0,void l(t.tts.baseUrl,t.tts.voice,"How far? Cross-AI don ready.").then(u=>{u.onended=()=>{a.textContent=" Talk",a.disabled=!1}});if(!c){const d=window.SpeechRecognition||window.webkitSpeechRecognition;r=new d,r.lang="en-NG",r.interimResults=!1,r.maxAlternatives=1,c=!0,a.classList.add("pvw-on"),a.textContent=" Listening",r.onresult=async u=>{const f=u.results[0][0].transcript||"";a.textContent="thinking";try{const g=await i(t.agent.baseUrl,f);a.textContent="speaking";const m=await l(t.tts.baseUrl,t.tts.voice,g);m.onended=()=>{a.textContent=" Talk",a.classList.remove("pvw-on"),c=!1}}catch{a.textContent="(error)",setTimeout(()=>{a.textContent=" Talk"},1500)}};r.onend=()=>{c&&(a.textContent=" Talk",a.classList.remove("pvw-on"),c=!1)},r.start()}else try{r.stop()}catch{}a.textContent=" Talk",a.classList.remove("pvw-on"),c=!1}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p();})();
